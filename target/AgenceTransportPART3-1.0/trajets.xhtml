<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" xmlns:h="jakarta.faces.html" xmlns:f="jakarta.faces.core"
    xmlns:ui="jakarta.faces.facelets">
<ui:composition template="template.xhtml">
    <ui:define name="title">Trajets - Agence Transport</ui:define>

    <ui:define name="content">
        <div class="card mb-4">
            <div class="d-flex justify-content-between align-items-center mb-4">
                <h2>üöç Gestion des Trajets</h2>
                <h:form>
                    <h:commandButton action="#{trajetBean.loadTrajets}" value="Actualiser"
                        styleClass="btn btn-outline-primary btn-sm rounded-pill" />
                </h:form>
            </div>

            <div class="table-container">
                <h:dataTable value="#{trajetBean.trajets}" var="t" styleClass="w-100">
                    <h:column>
                        <f:facet name="header">ID</f:facet>
                        #{t.id}
                    </h:column>
                    <h:column>
                        <f:facet name="header">Itin√©raire</f:facet>
                        <div class="fw-bold">#{t.departureLocation} ‚Üí #{t.destinationLocation}</div>
                        <small class="text-muted">D√©part: #{t.departureDate}</small>
                    </h:column>
                    <h:column>
                        <f:facet name="header">Ressources</f:facet>
                        <div><small>Bus: #{t.busNumber}</small></div>
                        <div><small>Chauffeur: #{t.chauffeurName}</small></div>
                    </h:column>
                    <h:column>
                        <f:facet name="header">Statut</f:facet>
                        <span class="badge #{t.status == 'PLANNED' ? 'badge-info' : 
                                          t.status == 'IN_PROGRESS' ? 'badge-warning' : 
                                          t.status == 'COMPLETED' ? 'badge-success' : 'badge-danger'}">
                            #{t.status}
                        </span>
                    </h:column>
                    <h:column>
                        <f:facet name="header">Actions</f:facet>
                        <h:form styleClass="d-inline">
                            <h:commandLink action="#{trajetBean.startTrajet(t.id)}"
                                styleClass="btn btn-sm btn-outline-primary me-1" rendered="#{t.status == 'PLANNED'}">
                                D√©marrer
                            </h:commandLink>
                            <h:commandLink action="#{trajetBean.completeTrajet(t.id)}"
                                styleClass="btn btn-sm btn-outline-success me-1"
                                rendered="#{t.status == 'IN_PROGRESS'}">
                                Terminer
                            </h:commandLink>
                            <h:commandLink action="#{trajetBean.cancelTrajet(t.id)}"
                                styleClass="btn btn-sm btn-outline-danger"
                                rendered="#{t.status == 'PLANNED' or t.status == 'IN_PROGRESS'}">
                                Annuler
                            </h:commandLink>
                        </h:form>
                    </h:column>
                </h:dataTable>
            </div>
        </div>
    </ui:define>
</ui:composition>

</html>